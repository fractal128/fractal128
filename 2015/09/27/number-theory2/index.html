<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>åˆç­‰æ•°è®ºï¼ˆäºŒï¼‰ | Zone-128</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="/atom.xml" title="Zone-128" type="application/atom+xml">
    
</head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/archives" class="header__link">Archive</a>
			
				<a href="/tags" class="header__link">Tags</a>
			
				<a href="/music" class="header__link">Music</a>
			
				<a href="/about" class="header__link">About</a>
			
		</nav>
		<h1 class="header__title"><a href="/">Zone-128</a></h1>
		<h2 class="header__subtitle"></h2>
	</header>

	<main>
		<article>
	
		<h1>åˆç­‰æ•°è®ºï¼ˆäºŒï¼‰</h1>
	
	<div class="article__infos">
		<span class="article__date">2015-09-27</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/OI/">OI</a> > <a class="article-category-link" href="/categories/OI/æ•°è®º/">æ•°è®º</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/æ•°è®º/">æ•°è®º</a>
			</span>
		
	</div>

	

	
		<p>ä¸­ç§‹å¿«ä¹ï¼<br>ç»§ç»­å¡«å‘å–½ã€‚ã€‚ã€‚<br><a id="more"></a></p>
<h1 id="åˆç­‰æ•°è®º"><a href="#åˆç­‰æ•°è®º" class="headerlink" title="åˆç­‰æ•°è®º"></a>åˆç­‰æ•°è®º</h1><h2 id="æ•°è®ºç­›æ³•"><a href="#æ•°è®ºç­›æ³•" class="headerlink" title="æ•°è®ºç­›æ³•"></a>æ•°è®ºç­›æ³•</h2><h3 id="Eraosthensç­›æ³•"><a href="#Eraosthensç­›æ³•" class="headerlink" title="Eraosthensç­›æ³•"></a>Eraosthensç­›æ³•</h3><p>åŸºæœ¬ç­›æ³•ï¼Œä¸€èˆ¬æƒ…å†µä¸‹éƒ½ä¸ä¼šè¢«å¡ï¼Œæ—¶é—´å¤æ‚åº¦Î˜(nlogn)[æˆ‘ä¸ä¼šç®—ã€‚ã€‚ã€‚</p>
<h3 id="çº¿æ€§ç­›æ³•-ç§¯æ€§å‡½æ•°"><a href="#çº¿æ€§ç­›æ³•-ç§¯æ€§å‡½æ•°" class="headerlink" title="çº¿æ€§ç­›æ³•(ç§¯æ€§å‡½æ•°)"></a>çº¿æ€§ç­›æ³•(ç§¯æ€§å‡½æ•°)</h3><p>æ—¶é—´å¤æ‚åº¦Î˜(n)[è¿˜æ˜¯ä¸ä¼šç®—ã€‚ã€‚ã€‚<br>ç›´æ¥æ”¾ä»£ç ã€‚ã€‚ã€‚<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>(i=i;i&lt;=n;i++)</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span>(!mindiv[i])prime[++tot]=mindiv[i]=i;</div><div class="line">    <span class="keyword">for</span>(j=<span class="number">1</span>;j&lt;=tot&amp;&amp;prime[j]&lt;=mindiv[i]&amp;&amp;(k=prime[j]*i)&lt;=n;j++)</div><div class="line">    mindiv[k]=prime[j];</div><div class="line">&#125;</div><div class="line"><span class="comment">//mindiv[k]è¡¨ç¤ºkçš„æœ€å°è´¨å› æ•°ï¼Œè¿™æ ·ä¿è¯äº†æ¯ä¸€ä¸ªæ•°åªä¼šè¢«ä»–çš„æœ€å°è´¨å› æ•°ç­›æ‰ä¸€éã€‚</span></div></pre></td></tr></table></figure></p>
<h3 id="å¸¸ç”¨æ€§è´¨"><a href="#å¸¸ç”¨æ€§è´¨" class="headerlink" title="å¸¸ç”¨æ€§è´¨"></a>å¸¸ç”¨æ€§è´¨</h3><p>nä»¥å†…ç´ æ•°ä¸ªæ•°O(n/ln(n))</p>
<h2 id="ç´ æ•°æµ‹è¯•"><a href="#ç´ æ•°æµ‹è¯•" class="headerlink" title="ç´ æ•°æµ‹è¯•"></a>ç´ æ•°æµ‹è¯•</h2><h3 id="Fermatç´ æ•°æµ‹è¯•"><a href="#Fermatç´ æ•°æµ‹è¯•" class="headerlink" title="Fermatç´ æ•°æµ‹è¯•"></a>Fermatç´ æ•°æµ‹è¯•</h3><h4 id="è´¹é©¬å°å®šç†"><a href="#è´¹é©¬å°å®šç†" class="headerlink" title="è´¹é©¬å°å®šç†"></a>è´¹é©¬å°å®šç†</h4><blockquote>
<p>å¯¹äºç´ æ•°pä¸ä»»æ„ä¸päº’ç´ çš„æ•´æ•°aæ»¡è¶³a(p-1) â‰¡1(mod p)</p>
</blockquote>
<h4 id="è¯æ˜"><a href="#è¯æ˜" class="headerlink" title="è¯æ˜"></a>è¯æ˜</h4><blockquote><p>è¿™ä¸ªè¯æ˜å°±æœ‰ç‚¹éº»çƒ¦äº†ã€‚<br>    é¦–å…ˆæˆ‘ä»¬è¯æ˜è¿™æ ·ä¸€ä¸ªç»“è®ºï¼šå¦‚æœpæ˜¯ä¸€ä¸ªç´ æ•°çš„è¯ï¼Œé‚£ä¹ˆå¯¹ä»»æ„ä¸€ä¸ªå°äºpçš„æ­£æ•´æ•°aï¼Œa, 2a, 3a, â€¦, (p-1)aé™¤ä»¥pçš„ä½™æ•°æ­£å¥½æ˜¯ä¸€ä¸ª1åˆ°p-1çš„æ’åˆ—ã€‚ä¾‹å¦‚ï¼Œ5æ˜¯ç´ æ•°ï¼Œ3, 6, 9, 12é™¤ä»¥5çš„ä½™æ•°åˆ†åˆ«ä¸º3, 1, 4, 2ï¼Œæ­£å¥½å°±æ˜¯1åˆ°4è¿™å››ä¸ªæ•°ã€‚<br>    åè¯æ³•ï¼Œå‡å¦‚ç»“è®ºä¸æˆç«‹çš„è¯ï¼Œé‚£ä¹ˆå°±æ˜¯è¯´æœ‰ä¸¤ä¸ªå°äºpçš„æ­£æ•´æ•°må’Œnä½¿å¾—naå’Œmaé™¤ä»¥pçš„ä½™æ•°ç›¸åŒã€‚ä¸å¦¨å‡è®¾n&gt;mï¼Œåˆ™på¯ä»¥æ•´é™¤a(n-m)ã€‚ä½†pæ˜¯ç´ æ•°ï¼Œé‚£ä¹ˆaå’Œn-mä¸­è‡³å°‘æœ‰ä¸€ä¸ªå«æœ‰å› å­pã€‚è¿™æ˜¾ç„¶æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºaå’Œn-méƒ½æ¯”på°ã€‚<br>    ç”¨åŒä½™å¼è¡¨è¿°ï¼Œæˆ‘ä»¬è¯æ˜äº†ï¼š<br>(p-1)! â‰¡ a * 2a * 3a * â€¦ * (p-1)a (mod p)<br>    ä¹Ÿå³ï¼š<br>(p-1)! â‰¡ (p-1)! * a^(p-1) (mod p)<br>    ä¸¤è¾¹åŒæ—¶é™¤ä»¥(p-1)!ï¼Œå°±å¾—åˆ°äº†æˆ‘ä»¬çš„æœ€ç»ˆç»“è®ºï¼š<br>1 â‰¡ a^(p-1) (mod p)</p>
<footer><strong>Matrix67</strong><cite><a href="http://www.matrix67.com/blog/archives/234" target="_blank" rel="external">æ•°è®ºéƒ¨åˆ†ç¬¬ä¸€èŠ‚ï¼šç´ æ•°ä¸ç´ æ€§æµ‹è¯•</a></cite></footer></blockquote>
<h4 id="é™åˆ¶ä¸ä¼ªç´ æ•°"><a href="#é™åˆ¶ä¸ä¼ªç´ æ•°" class="headerlink" title="é™åˆ¶ä¸ä¼ªç´ æ•°"></a>é™åˆ¶ä¸ä¼ªç´ æ•°</h4><blockquote><p>è°ˆåˆ°Fermatå°å®šç†ï¼Œæ•°å­¦å†å²ä¸Šæœ‰å¾ˆå¤šè¯¯è§£ã€‚å¾ˆé•¿ä¸€æ®µæ—¶é—´é‡Œï¼Œäººä»¬éƒ½è®¤ä¸ºFermatå°å®šç†çš„é€†å‘½é¢˜æ˜¯æ­£ç¡®çš„ï¼Œå¹¶ä¸”æœ‰äººäº²è‡ªéªŒè¯äº†a=2, p&lt;300çš„æ‰€æœ‰æƒ…å†µã€‚å›½å¤–ç”šè‡³æµä¼ ç€ä¸€ç§è¯´æ³•ï¼Œè®¤ä¸ºä¸­å›½åœ¨å­”å­æ—¶ä»£å°±è¯æ˜äº†è¿™æ ·çš„å®šç†ï¼šå¦‚æœnæ•´é™¤2^(n-1)-1ï¼Œåˆ™nå°±æ˜¯ç´ æ•°ã€‚åæ¥æŸä¸ªè‹±å›½å­¦è€…è¿›è¡Œè€ƒè¯åæ‰å‘ç°é‚£æ˜¯å› ä¸ºä»–ä»¬ç¿»è¯‘ä¸­å›½å¤æ–‡æ—¶å‡ºäº†é”™ã€‚1819å¹´æœ‰äººå‘ç°äº†Fermatå°å®šç†é€†å‘½é¢˜çš„ç¬¬ä¸€ä¸ªåä¾‹ï¼šè™½ç„¶2çš„340æ¬¡æ–¹é™¤ä»¥341ä½™1ï¼Œä½†341=11*31ã€‚åæ¥ï¼Œäººä»¬åˆå‘ç°äº†561, 645, 1105ç­‰æ•°éƒ½è¡¨æ˜a=2æ—¶Fermatå°å®šç†çš„é€†å‘½é¢˜ä¸æˆç«‹ã€‚è™½ç„¶è¿™æ ·çš„æ•°ä¸å¤šï¼Œä½†ä¸èƒ½å¿½è§†å®ƒä»¬çš„å­˜åœ¨ã€‚äºæ˜¯ï¼Œäººä»¬æŠŠæ‰€æœ‰èƒ½æ•´é™¤2^(n-1)-1çš„åˆæ•°nå«åšä¼ªç´ æ•°(pseudoprime)ï¼Œæ„æ€å°±æ˜¯å‘Šè¯‰äººä»¬è¿™ä¸ªç´ æ•°æ˜¯å‡çš„ã€‚</p>
<p>ä¸æ»¡è¶³2^(n-1) mod n = 1çš„nä¸€å®šä¸æ˜¯ç´ æ•°ï¼›å¦‚æœæ»¡è¶³çš„è¯åˆ™å¤šåŠæ˜¯ç´ æ•°ã€‚è¿™æ ·ï¼Œä¸€ä¸ªæ¯”è¯•é™¤æ³•æ•ˆç‡æ›´é«˜çš„ç´ æ€§åˆ¤æ–­æ–¹æ³•å‡ºç°äº†ï¼šåˆ¶ä½œä¸€å¼ ä¼ªç´ æ•°è¡¨ï¼Œè®°å½•æŸä¸ªèŒƒå›´å†…çš„æ‰€æœ‰ä¼ªç´ æ•°ï¼Œé‚£ä¹ˆæ‰€æœ‰æ»¡è¶³2^(n-1) mod n = 1ä¸”ä¸åœ¨ä¼ªç´ æ•°è¡¨ä¸­çš„nå°±æ˜¯ç´ æ•°ã€‚ä¹‹æ‰€ä»¥è¿™ç§æ–¹æ³•æ›´å¿«ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬å¯ä»¥ä½¿ç”¨äºŒåˆ†æ³•å¿«é€Ÿè®¡ç®—2^(n-1) mod n çš„å€¼ï¼Œè¿™åœ¨è®¡ç®—æœºçš„å¸®åŠ©ä¸‹å˜å¾—éå¸¸å®¹æ˜“ï¼›åœ¨è®¡ç®—æœºä¸­ä¹Ÿå¯ä»¥ç”¨äºŒåˆ†æŸ¥æ‰¾æœ‰åºæ•°åˆ—ã€Hashè¡¨å¼€æ•£åˆ—ã€æ„å»ºTrieæ ‘ç­‰æ–¹æ³•ä½¿å¾—æŸ¥æ‰¾ä¼ªç´ æ•°è¡¨æ•ˆç‡æ›´é«˜ã€‚</p>
<p>æœ‰äººè‡ªç„¶ä¼šå…³å¿ƒè¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šä¼ªç´ æ•°çš„ä¸ªæ•°åˆ°åº•æœ‰å¤šå°‘ï¼Ÿæ¢å¥è¯è¯´ï¼Œå¦‚æœæˆ‘åªè®¡ç®—2^(n-1) mod nçš„å€¼ï¼Œäº‹å…ˆä¸å‡†å¤‡ä¼ªç´ æ•°è¡¨ï¼Œé‚£ä¹ˆç´ æ€§åˆ¤æ–­å‡ºé”™çš„æ¦‚ç‡æœ‰å¤šå°‘ï¼Ÿç ”ç©¶è¿™ä¸ªé—®é¢˜æ˜¯å¾ˆæœ‰ä»·å€¼çš„ï¼Œæ¯•ç«Ÿæˆ‘ä»¬æ˜¯OIerï¼Œä¸å¯èƒ½èƒŒä¸€ä¸ªé•¿åº¦ä¸Šåƒçš„å¸¸é‡æ•°ç»„å¸¦ä¸Šè€ƒåœºã€‚ç»Ÿè®¡è¡¨æ˜ï¼Œåœ¨å‰10äº¿ä¸ªè‡ªç„¶æ•°ä¸­å…±æœ‰50847534ä¸ªç´ æ•°ï¼Œè€Œæ»¡è¶³2^(n-1) mod n = 1çš„åˆæ•°næœ‰5597ä¸ªã€‚è¿™æ ·ç®—ä¸‹æ¥ï¼Œç®—æ³•å‡ºé”™çš„å¯èƒ½æ€§çº¦ä¸º0.00011ã€‚è¿™ä¸ªæ¦‚ç‡å¤ªé«˜äº†ï¼Œå¦‚æœæƒ³å…å»å»ºç«‹ä¼ªç´ æ•°è¡¨çš„å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦æ”¹è¿›ç´ æ€§åˆ¤æ–­çš„ç®—æ³•ã€‚  </p>
<p>æœ€ç®€å•çš„æƒ³æ³•å°±æ˜¯ï¼Œæˆ‘ä»¬åˆšæ‰åªè€ƒè™‘äº†a=2çš„æƒ…å†µã€‚å¯¹äºå¼å­a^(n-1) mod nï¼Œå–ä¸åŒçš„aå¯èƒ½å¯¼è‡´ä¸åŒçš„ç»“æœã€‚ä¸€ä¸ªåˆæ•°å¯èƒ½åœ¨a=2æ—¶é€šè¿‡äº†æµ‹è¯•ï¼Œä½†a=3æ—¶çš„è®¡ç®—ç»“æœå´æ’é™¤äº†ç´ æ•°çš„å¯èƒ½ã€‚äºæ˜¯ï¼Œäººä»¬æ‰©å±•äº†ä¼ªç´ æ•°çš„å®šä¹‰ï¼Œç§°æ»¡è¶³a^(n-1) mod n = 1çš„åˆæ•°nå«åšä»¥aä¸ºåº•çš„ä¼ªç´ æ•°(pseudoprime to base a)ã€‚å‰10äº¿ä¸ªè‡ªç„¶æ•°ä¸­åŒæ—¶ä»¥2å’Œ3ä¸ºåº•çš„ä¼ªç´ æ•°åªæœ‰1272ä¸ªï¼Œè¿™ä¸ªæ•°ç›®ä¸åˆ°åˆšæ‰çš„1/4ã€‚è¿™å‘Šè¯‰æˆ‘ä»¬å¦‚æœåŒæ—¶éªŒè¯a=2å’Œa=3ä¸¤ç§æƒ…å†µï¼Œç®—æ³•å‡ºé”™çš„æ¦‚ç‡é™åˆ°äº†0.000025ã€‚å®¹æ˜“æƒ³åˆ°ï¼Œé€‰æ‹©ç”¨æ¥æµ‹è¯•çš„aè¶Šå¤šï¼Œç®—æ³•è¶Šå‡†ç¡®ã€‚é€šå¸¸æˆ‘ä»¬çš„åšæ³•æ˜¯ï¼Œéšæœºé€‰æ‹©è‹¥å¹²ä¸ªå°äºå¾…æµ‹æ•°çš„æ­£æ•´æ•°ä½œä¸ºåº•æ•°aè¿›è¡Œè‹¥å¹²æ¬¡æµ‹è¯•ï¼Œåªè¦æœ‰ä¸€æ¬¡æ²¡æœ‰é€šè¿‡æµ‹è¯•å°±ç«‹å³æŠŠè¿™ä¸ªæ•°æ‰”å›åˆæ•°çš„ä¸–ç•Œã€‚è¿™å°±æ˜¯Fermatç´ æ€§æµ‹è¯•ã€‚</p>
<p>äººä»¬è‡ªç„¶ä¼šæƒ³ï¼Œå¦‚æœè€ƒè™‘äº†æ‰€æœ‰å°äºnçš„åº•æ•°aï¼Œå‡ºé”™çš„æ¦‚ç‡æ˜¯å¦å°±å¯ä»¥é™åˆ°0å‘¢ï¼Ÿæ²¡æƒ³åˆ°çš„æ˜¯ï¼Œå±…ç„¶å°±æœ‰è¿™æ ·çš„åˆæ•°ï¼Œå®ƒå¯ä»¥é€šè¿‡æ‰€æœ‰açš„æµ‹è¯•ï¼ˆè¿™ä¸ªè¯´æ³•ä¸å‡†ç¡®ï¼Œè¯¦è§æˆ‘åœ¨åœ°æ ¸æ¥¼å±‚çš„å›å¤ï¼‰ã€‚Carmichaelç¬¬ä¸€ä¸ªå‘ç°è¿™æ ·æç«¯çš„ä¼ªç´ æ•°ï¼Œä»–æŠŠå®ƒä»¬ç§°ä½œCarmichaelæ•°ã€‚ä½ ä¸€å®šä¼šä»¥ä¸ºè¿™æ ·çš„æ•°ä¸€å®šå¾ˆå¤§ã€‚é”™ã€‚ç¬¬ä¸€ä¸ªCarmichaelæ•°å°å¾—æƒŠäººï¼Œä»…ä»…æ˜¯ä¸€ä¸ªä¸‰ä½æ•°ï¼Œ561ã€‚å‰10äº¿ä¸ªè‡ªç„¶æ•°ä¸­Carmichaelæ•°ä¹Ÿæœ‰600ä¸ªä¹‹å¤šã€‚Carmichaelæ•°çš„å­˜åœ¨è¯´æ˜ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç»§ç»­åŠ å¼ºç´ æ€§åˆ¤æ–­çš„ç®—æ³•ã€‚</p>
<footer><strong>Matrix67</strong><cite><a href="http://www.matrix67.com/blog/archives/234" target="_blank" rel="external">æ•°è®ºéƒ¨åˆ†ç¬¬ä¸€èŠ‚ï¼šç´ æ•°ä¸ç´ æ€§æµ‹è¯•</a></cite></footer></blockquote>
<h3 id="Miller-Rabin-ç´ æ€§æµ‹è¯•ä¸äºŒæ¬¡æ¢æµ‹"><a href="#Miller-Rabin-ç´ æ€§æµ‹è¯•ä¸äºŒæ¬¡æ¢æµ‹" class="headerlink" title="Miller-Rabin ç´ æ€§æµ‹è¯•ä¸äºŒæ¬¡æ¢æµ‹"></a>Miller-Rabin ç´ æ€§æµ‹è¯•ä¸äºŒæ¬¡æ¢æµ‹</h3><blockquote>
<p>Miller-Rabinç®—æ³•æ˜¯ç›®å‰ä¸»æµçš„åŸºäºæ¦‚ç‡çš„ç´ æ•°æµ‹è¯•ç®—æ³•ï¼Œåœ¨æ„å»ºå¯†ç å®‰å…¨ä½“ç³»ä¸­å æœ‰é‡è¦çš„åœ°ä½ã€‚é€šè¿‡æ¯”è¾ƒå„ç§ç´ æ•°æµ‹è¯•ç®—æ³•å’Œå¯¹Miller-Rabinç®—æ³•è¿›è¡Œçš„ä»”ç»†ç ”ç©¶ï¼Œè¯æ˜åœ¨è®¡ç®—æœºä¸­æ„å»ºå¯†ç å®‰å…¨ä½“ç³»æ—¶ï¼Œ Miller-Rainç®—æ³•æ˜¯å®Œæˆç´ æ•°æµ‹è¯•çš„æœ€ä½³é€‰æ‹©ã€‚é€šè¿‡å¯¹Miller-Rabin ç®—æ³•åº•å±‚è¿ç®—çš„ä¼˜åŒ–ï¼Œå¯ä»¥å–å¾—è¾ƒä»¥å¾€å®ç°æ›´å¥½çš„æ€§èƒ½ã€‚</p>
</blockquote>
<p>ä»¥ä¸ŠåŸºæœ¬æ²¡ç”¨ã€‚ã€‚ä¸‹é¢æ˜¯è¯¥ç®—æ³•çš„ä¸€äº›å¼•ç†</p>
<blockquote>
<p>äºŒæ¬¡æ¢æµ‹å¼•ç†ï¼šè‹¥pä¸ºå¥‡ç´ æ•°ï¼Œæ–¹ç¨‹x^2â‰¡1(mod p)çš„è§£åªæœ‰Â±1<br>long long èŒƒå›´å†…çš„æ‰€æœ‰æ•´æ•°å‡èƒ½ç”¨å‰9ä¸ªç´ æ•°è¿›è¡Œå‡†ç¡®çš„äºŒæ¬¡æ¢æµ‹</p>
</blockquote>
<h3 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h3><p><a href="http://codevs.cn/problem/1702/" target="_blank" rel="external">codevs1702</a><br>ä¸€ä¸ªæ•°ï¼Œä»–æ˜¯ç´ æ•°ä¹ˆï¼Ÿ<br>è®¾ä»–ä¸ºPæ»¡è¶³(P&lt;=2^63-1)</p>
<p>Code<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> n=<span class="number">16</span>;</div><div class="line"><span class="keyword">const</span> ll p[<span class="number">17</span>]=&#123;<span class="number">0</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">17</span>,<span class="number">19</span>,<span class="number">23</span>,<span class="number">29</span>,<span class="number">31</span>,<span class="number">37</span>,<span class="number">41</span>,<span class="number">43</span>,<span class="number">47</span>,<span class="number">53</span>&#125;;</div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line">ll x;</div><div class="line"><span class="function">ll <span class="title">mul</span><span class="params">(ll a,ll b,ll MOD)</span></span>&#123;</div><div class="line">	ll ans=<span class="number">0</span>;</div><div class="line">	<span class="keyword">while</span> (b&gt;<span class="number">0</span>)&#123;</div><div class="line">		<span class="keyword">if</span> ((b &amp; <span class="number">1</span>)==<span class="number">1</span>)&#123;</div><div class="line">			ans+=a; ans%=MOD;</div><div class="line">		&#125;</div><div class="line">		a=(a+a)%MOD;</div><div class="line">		b&gt;&gt;=<span class="number">1</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> ans;</div><div class="line">&#125;</div><div class="line"><span class="function">ll <span class="title">power</span><span class="params">(ll a,ll b,ll MOD)</span></span>&#123;</div><div class="line">	ll ans=<span class="number">1</span>;</div><div class="line">	<span class="keyword">while</span> (b&gt;<span class="number">0</span>)&#123;</div><div class="line">		<span class="keyword">if</span> ((b &amp; <span class="number">1</span>)==<span class="number">1</span>) ans=mul(ans,a,MOD);</div><div class="line">		a=mul(a,a,MOD);</div><div class="line">		b&gt;&gt;=<span class="number">1</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> ans;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">Isprime</span><span class="params">(ll a, ll b)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span> (b==<span class="number">2</span>) <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">	<span class="keyword">if</span> ((b==<span class="number">1</span>)||((b &amp; <span class="number">1</span>)==<span class="number">0</span>)) <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">	ll t=b<span class="number">-1</span>;</div><div class="line">	<span class="keyword">while</span> ((t &amp; <span class="number">1</span>)==<span class="number">0</span>) t&gt;&gt;=<span class="number">1</span>;</div><div class="line">	ll tmp=power(a,t,b);</div><div class="line">	<span class="keyword">while</span> ((t!=b<span class="number">-1</span>)&amp;&amp;(tmp!=<span class="number">1</span>)&amp;&amp;(tmp!=b<span class="number">-1</span>))&#123;</div><div class="line">		tmp=mul(tmp,tmp,b);</div><div class="line">		t&lt;&lt;=<span class="number">1</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> ((tmp==b<span class="number">-1</span>)||((t &amp; <span class="number">1</span>)==<span class="number">1</span>)) <span class="keyword">return</span> <span class="number">1</span>; <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%lld"</span>,&amp;x);</div><div class="line">	<span class="keyword">int</span> flag=<span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; i++)&#123;</div><div class="line">		<span class="keyword">if</span> (p[i]==x)&#123;</div><div class="line">			<span class="built_in">puts</span>(<span class="string">"Yes"</span>);</div><div class="line">			<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">		&#125;<span class="keyword">else</span>&#123;</div><div class="line">			flag=flag &amp; Isprime(p[i],x);</div><div class="line">			<span class="keyword">if</span> (flag==<span class="number">0</span>) &#123;<span class="keyword">break</span>;&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> (flag==<span class="number">1</span>) <span class="built_in">puts</span>(<span class="string">"Yes"</span>); <span class="keyword">else</span> <span class="built_in">puts</span>(<span class="string">"No"</span>);</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="è´¨å› æ•°åˆ†è§£æ³•"><a href="#è´¨å› æ•°åˆ†è§£æ³•" class="headerlink" title="è´¨å› æ•°åˆ†è§£æ³•"></a>è´¨å› æ•°åˆ†è§£æ³•</h2><h3 id="O-sqrt-n-æš´åŠ›åˆ†è§£"><a href="#O-sqrt-n-æš´åŠ›åˆ†è§£" class="headerlink" title="O(sqrt(n))æš´åŠ›åˆ†è§£"></a>O(sqrt(n))æš´åŠ›åˆ†è§£</h3><h3 id="Pollard-Rhoæ¤­åœ†æ›²çº¿åˆ†è§£æ³•"><a href="#Pollard-Rhoæ¤­åœ†æ›²çº¿åˆ†è§£æ³•" class="headerlink" title="Pollard-Rhoæ¤­åœ†æ›²çº¿åˆ†è§£æ³•"></a>Pollard-Rhoæ¤­åœ†æ›²çº¿åˆ†è§£æ³•</h3><p>è¿™å‘å¤ªå¤§äº†ï¼Œæœ‰ç‚¹å¡«ä¸åŠ¨è¯¥æ€ä¹ˆåŠã€‚ã€‚ã€‚</p>
<p>ç»è¿‡ä¸€æ™šä¸Šçš„å­¦ä¹ ï¼Œç»ˆäº<del>è¿˜æ˜¯æ²¡æ‡‚</del><br>å…¶å®æ˜¯æ‰¾åˆ°äº†ä¸€ä¸ªå…³äºpollard-rhoç®—æ³•çš„å¾ˆå¥½çš„<a href="http://wenku.baidu.com/link?url=T5oeGiGSqfaurODiXMoErWJS1G8z4M0pnXf24x-gqgxswPyNmxdLdd2UByJPVYAqW-991k5UjJIeABtzQlu1MOGZ4072fQPeBopHiGiPm7m" target="_blank" rel="external">Tutorial</a><br>ç‰µæ‰¯åˆ°åœ†é”¥æ›²çº¿çš„æ–¹é¢å¤ªéš¾äº†ï¼Œæœ‰å…´è¶£çš„å¯ä»¥è‡ªè¡Œæ·±å…¥ç ”ç©¶ï¼Œç„¶åæˆ‘ä»¬äº†è§£ä¸€ä¸‹pollard-rhoçš„åŸç†ã€‚<br>æ®ç ”ç©¶å¯å¾—(å…·ä½“å¯ä»¥çœ‹é‚£ä¸ªtutorial)ï¼Œå½“æˆ‘ä»¬åœ¨ä¸€å®šèŒƒå›´å†…éšæœºæ•°çš„æ—¶å€™ï¼Œéšè®°ä¸€äº›æ•°å¹¶ä½¿ç”¨å®ƒä»¬çš„å·®å€¼ä½œä¸ºç»“æœæ•ˆæœä¼šè¿œè¿œä¼˜äºæœ´ç´ çš„æšä¸¾æ³•ï¼»ç”Ÿæ—¥æ‚–è®ºï¼½ã€‚<br>åˆ©ç”¨ä»¥ä¸Šæ€§è´¨æˆ‘ä»¬å¯ä»¥è®¾è®¡ä¸€ç§ç®—æ³•ï¼Œæ¥éšæœºæšä¸¾ä¸€ä¸ªå¯ä»¥æ•´é™¤å¾…åˆ†è§£å¤§è´¨æ•°çš„æ•°ï¼Œå…·ä½“å¦‚ä¸‹ã€‚</p>
<p>æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå‡½æ•°æ¥ç”Ÿæˆä¼ªéšæœºæ•°ã€‚<br>æ¢å¥è¯è¯´,æˆ‘ä»¬ä¸æ–­åœ°ä½¿ç”¨å‡½æ•° ğ‘“ æ¥ç”Ÿæˆ(çœ‹ä¸Šå»æˆ–è€…è¯´æ„Ÿè§‰ä¸Šåƒçš„)éšæœºæ•°ã€‚ å¹¶ä¸æ˜¯æ‰€æœ‰çš„å‡½éƒ½èƒ½å¤Ÿè¿™æ ·åš,ä½†æ˜¯æœ‰ä¸€ä¸ªç¥å¥‡çš„å‡½æ•°å¯ä»¥ã€‚å®ƒå°±æ˜¯</p>
<p> $$ f(x)=x^2+c$$</p>
<p>( æˆ‘ä»¬å¯ä»¥è‡ªå·±æŒ‡å®šğ‘,ä¹Ÿå¯ä»¥ç”¨ rand()éšå³å‡½æ•°æ¥ç”Ÿæˆ,è¿™ä¸æ˜¯é‡ç‚¹ )<br>æˆ‘ä»¬ä»ğ‘¥1 = 2 æˆ–è€…å…¶ä»–æ•°å¼€å§‹,è®©ğ‘¥2 = ğ‘“(ğ‘¥1), ğ‘¥3 = ğ‘“(ğ‘¥2), â€¦ â€¦ ç”Ÿæˆè§„åˆ™ä¸ºğ‘¥ğ‘›+1 = ğ‘“(ğ‘¥ğ‘›)</p>
<p>å…·ä½“å®ç°å’Œè¯¦ç»†è¿‡ç¨‹éƒ½åœ¨é‚£ä»½PDFä¸­ï¼»æˆ‘åªæ˜¯ä¸ªæ¬è¿å·¥ã€‚ã€‚ã€‚</p>
<p>è‡ªå·±å†™çš„bzoj3667, ä¸ºä»€ä¹ˆTäº†ã€‚ã€‚ã€‚ä¸æ‡‚ï¼Œä»¥åå†æ”¹å§ã€‚</p>
<p>é”™è¯¯çš„Code<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> NN=<span class="number">5</span>;</div><div class="line"><span class="keyword">const</span> ll p[<span class="number">6</span>]=&#123;<span class="number">0</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">61</span>,<span class="number">24251</span>&#125;;</div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="function">ll <span class="title">read</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    ll x=<span class="number">0</span>,f=<span class="number">1</span>;<span class="keyword">char</span> ch=getchar();</div><div class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">'0'</span>||ch&gt;<span class="string">'9'</span>)&#123;<span class="keyword">if</span>(ch==<span class="string">'-'</span>)f=<span class="number">-1</span>;ch=getchar();&#125;</div><div class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">'0'</span>&amp;&amp;ch&lt;=<span class="string">'9'</span>)&#123;x=x*<span class="number">10</span>+ch-<span class="string">'0'</span>;ch=getchar();&#125;</div><div class="line">    <span class="keyword">return</span> x*f;</div><div class="line">&#125;</div><div class="line">ll x;</div><div class="line">ll ans;</div><div class="line"><span class="function">ll <span class="title">gcd</span><span class="params">(ll x,ll y)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span> (x&lt;y) swap(x,y);</div><div class="line">	ll r = x % y;</div><div class="line">	<span class="keyword">while</span> (r!=<span class="number">0</span>)&#123;</div><div class="line">		ll tmp = r;</div><div class="line">		r = y % r;</div><div class="line">		x = y;</div><div class="line">		y = tmp;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> y;</div><div class="line">&#125;</div><div class="line"><span class="function">ll <span class="title">mul</span><span class="params">(ll a,ll b,ll p)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    ll tmp=(a*b-(ll)((<span class="keyword">long</span> <span class="keyword">double</span>)a/p*b+<span class="number">1e-8</span>)*p);</div><div class="line">    <span class="keyword">return</span> tmp&lt;<span class="number">0</span>?tmp+p:tmp;</div><div class="line">&#125;</div><div class="line"><span class="function">ll <span class="title">power</span><span class="params">(ll a,ll b,ll MOD)</span></span>&#123;</div><div class="line">	ll ans=<span class="number">1</span>;</div><div class="line">	<span class="keyword">while</span> (b&gt;<span class="number">0</span>)&#123;</div><div class="line">		<span class="keyword">if</span> ((b &amp; <span class="number">1</span>)==<span class="number">1</span>) ans=mul(ans,a,MOD);</div><div class="line">		a=mul(a,a,MOD);</div><div class="line">		b&gt;&gt;=<span class="number">1</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> ans;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">Isprime</span><span class="params">(ll a, ll b)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span> (b==<span class="number">2</span>) <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">	<span class="keyword">if</span> ((b==<span class="number">1</span>)||((b &amp; <span class="number">1</span>)==<span class="number">0</span>)) <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">	ll t=b<span class="number">-1</span>;</div><div class="line">	<span class="keyword">while</span> ((t &amp; <span class="number">1</span>)==<span class="number">0</span>) t&gt;&gt;=<span class="number">1</span>;</div><div class="line">	ll tmp=power(a,t,b);</div><div class="line">	<span class="keyword">while</span> ((t!=b<span class="number">-1</span>)&amp;&amp;(tmp!=<span class="number">1</span>)&amp;&amp;(tmp!=b<span class="number">-1</span>))&#123;</div><div class="line">		tmp=mul(tmp,tmp,b);</div><div class="line">		t&lt;&lt;=<span class="number">1</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> ((tmp==b<span class="number">-1</span>)||((t &amp; <span class="number">1</span>)==<span class="number">1</span>)) <span class="keyword">return</span> <span class="number">1</span>; <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">MR</span><span class="params">(ll x)</span></span>&#123;</div><div class="line">	<span class="keyword">int</span> flag=<span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=NN; i++)&#123;</div><div class="line">		<span class="keyword">if</span> (p[i]==x)&#123;</div><div class="line">			<span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">		&#125;<span class="keyword">else</span>&#123;</div><div class="line">			flag=flag &amp; Isprime(p[i],x);</div><div class="line">			<span class="keyword">if</span> (flag==<span class="number">0</span>) &#123;<span class="keyword">break</span>;&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> (flag==<span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>; <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function">ll <span class="title">f</span><span class="params">(ll x,ll y)</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> (mul(x,x,y)+rand()+<span class="number">12894</span>)%y;</div><div class="line">&#125;</div><div class="line"><span class="function">ll <span class="title">Prho</span><span class="params">(ll N)</span></span>&#123;</div><div class="line">	ll p=<span class="number">1</span>,t=<span class="number">0</span>;</div><div class="line">	<span class="keyword">if</span> (MR(N)==<span class="number">1</span>) <span class="keyword">return</span> N;</div><div class="line">	ll a=<span class="number">2</span>,b=<span class="number">2</span>;</div><div class="line">	<span class="keyword">while</span> (<span class="number">1</span>)&#123;</div><div class="line">		a=f(a,N);</div><div class="line">		b=f(f(b,N),N);</div><div class="line">		<span class="keyword">if</span> (a==b) <span class="keyword">break</span>;</div><div class="line">		<span class="keyword">if</span> (a&gt;b) t=a-b; <span class="keyword">else</span> t=b-a;</div><div class="line">		p=gcd(t,N);</div><div class="line">		<span class="keyword">if</span> (p&gt;<span class="number">1</span>) <span class="keyword">break</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> (p&gt;<span class="number">1</span>) <span class="keyword">return</span> max(Prho(p),Prho(N/p)); <span class="keyword">else</span> <span class="keyword">return</span> N;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="keyword">int</span> T;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;T);</div><div class="line">	<span class="keyword">while</span> (T--)&#123;</div><div class="line">		x=read();</div><div class="line">		<span class="keyword">if</span> (x==<span class="number">1</span>) <span class="built_in">puts</span>(<span class="string">"1"</span>); </div><div class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (MR(x)==<span class="number">1</span>) <span class="built_in">puts</span>(<span class="string">"Prime"</span>);</div><div class="line">		<span class="keyword">else</span>&#123;</div><div class="line">			ans=Prho(x);</div><div class="line">			<span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ans);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å‘ç°æˆ‘åœ¨å†™f(x)çš„æ—¶å€™æ¯æ¬¡éƒ½rand()äº†ï¼Œè¿™æ˜¯æç«¯é”™è¯¯çš„ã€‚ã€‚ã€‚<br>è€Œä¸”æƒ…å†µæ˜¯è¿™æ ·çš„ï¼Œå¦‚æœåœ¨miller-rabinç®—æ³•ä¸­ç”¨2,3,7,61,24251,é‚£ä¹ˆä¼šæœ‰ä¸€ä¸ªååˆ†å‰å®³çš„å«åš46 856 248 255 981çš„è¶…å¼ºä¼ªç´ æ•°çš„å­˜åœ¨ï¼ŒOTL</p>
<p>ACçš„Code<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> NN=<span class="number">5</span>;</div><div class="line"><span class="keyword">const</span> ll p[<span class="number">6</span>]=&#123;<span class="number">0</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">61</span>,<span class="number">24251</span>&#125;;</div><div class="line">ll ran;</div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="function">ll <span class="title">read</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    ll x=<span class="number">0</span>,f=<span class="number">1</span>;<span class="keyword">char</span> ch=getchar();</div><div class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">'0'</span>||ch&gt;<span class="string">'9'</span>)&#123;<span class="keyword">if</span>(ch==<span class="string">'-'</span>)f=<span class="number">-1</span>;ch=getchar();&#125;</div><div class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">'0'</span>&amp;&amp;ch&lt;=<span class="string">'9'</span>)&#123;x=x*<span class="number">10</span>+ch-<span class="string">'0'</span>;ch=getchar();&#125;</div><div class="line">    <span class="keyword">return</span> x*f;</div><div class="line">&#125;</div><div class="line">ll x;</div><div class="line">ll ans;</div><div class="line"><span class="function">ll <span class="title">gcd</span><span class="params">(ll x,ll y)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span> (x&lt;y) swap(x,y);</div><div class="line">    ll r = x % y;</div><div class="line">    <span class="keyword">while</span> (r!=<span class="number">0</span>)&#123;</div><div class="line">        ll tmp = r;</div><div class="line">        r = y % r;</div><div class="line">        x = y;</div><div class="line">        y = tmp;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> y;</div><div class="line">&#125;</div><div class="line"><span class="function">ll <span class="title">mul</span><span class="params">(ll a,ll b,ll p)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    ll tmp=(a*b-(ll)((<span class="keyword">long</span> <span class="keyword">double</span>)a/p*b+<span class="number">1e-8</span>)*p);</div><div class="line">    <span class="keyword">return</span> tmp&lt;<span class="number">0</span>?tmp+p:tmp;</div><div class="line">&#125;</div><div class="line"><span class="function">ll <span class="title">power</span><span class="params">(ll a,ll b,ll MOD)</span></span>&#123;</div><div class="line">    ll ans=<span class="number">1</span>;</div><div class="line">    <span class="keyword">while</span> (b&gt;<span class="number">0</span>)&#123;</div><div class="line">        <span class="keyword">if</span> ((b &amp; <span class="number">1</span>)==<span class="number">1</span>) ans=mul(ans,a,MOD);</div><div class="line">        a=mul(a,a,MOD);</div><div class="line">        b&gt;&gt;=<span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> ans;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">Isprime</span><span class="params">(ll a, ll b)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span> (b==<span class="number">2</span>) <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    <span class="keyword">if</span> ((b==<span class="number">1</span>)||((b &amp; <span class="number">1</span>)==<span class="number">0</span>)) <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    ll t=b<span class="number">-1</span>;</div><div class="line">    <span class="keyword">while</span> ((t &amp; <span class="number">1</span>)==<span class="number">0</span>) t&gt;&gt;=<span class="number">1</span>;</div><div class="line">    ll tmp=power(a,t,b);</div><div class="line">    <span class="keyword">while</span> ((t!=b<span class="number">-1</span>)&amp;&amp;(tmp!=<span class="number">1</span>)&amp;&amp;(tmp!=b<span class="number">-1</span>))&#123;</div><div class="line">        tmp=mul(tmp,tmp,b);</div><div class="line">        t&lt;&lt;=<span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> ((tmp==b<span class="number">-1</span>)||((t &amp; <span class="number">1</span>)==<span class="number">1</span>)) <span class="keyword">return</span> <span class="number">1</span>; <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">MR</span><span class="params">(ll x)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span> (x==<span class="number">46856248255981</span>) <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> flag=<span class="number">1</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=NN; i++)&#123;</div><div class="line">        <span class="keyword">if</span> (p[i]==x)&#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            flag=flag &amp; Isprime(p[i],x);</div><div class="line">            <span class="keyword">if</span> (flag==<span class="number">0</span>) &#123;<span class="keyword">break</span>;&#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (flag==<span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>; <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function">ll <span class="title">f</span><span class="params">(ll x,ll y)</span></span>&#123;</div><div class="line">    <span class="keyword">return</span> (mul(x,x,y)+ran+<span class="number">12894</span>)%y;</div><div class="line">&#125;</div><div class="line"><span class="function">ll <span class="title">Prho</span><span class="params">(ll N)</span></span>&#123;</div><div class="line">    ll p=<span class="number">1</span>,t=<span class="number">0</span>;</div><div class="line">    ll a=<span class="number">2</span>,b=<span class="number">2</span>;</div><div class="line">    <span class="keyword">while</span> (<span class="number">1</span>)&#123;</div><div class="line">        a=f(a,N);</div><div class="line">        b=f(f(b,N),N);</div><div class="line">        <span class="keyword">if</span> (a==b) <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">if</span> (a&gt;b) t=a-b; <span class="keyword">else</span> t=b-a;</div><div class="line">        p=gcd(t,N);</div><div class="line">        <span class="keyword">if</span> (p&gt;<span class="number">1</span>) <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> p;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function">ll <span class="title">work</span><span class="params">(ll x)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span> (MR(x)==<span class="number">1</span>) <span class="keyword">return</span> x;</div><div class="line">    <span class="keyword">if</span> (x==<span class="number">4</span>) <span class="keyword">return</span> <span class="number">2</span>;</div><div class="line">    ll p=x;</div><div class="line">    <span class="keyword">while</span> (p==x||p==<span class="number">1</span>)&#123;</div><div class="line">        ran=rand()+<span class="number">19980929</span>; ran%=x;</div><div class="line">        p=Prho(x);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> max(work(p),work(x/p));</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> T;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;T);</div><div class="line">    <span class="keyword">while</span> (T--)&#123;</div><div class="line">        x=read();</div><div class="line">        <span class="keyword">if</span> (x==<span class="number">1</span>) <span class="built_in">puts</span>(<span class="string">"1"</span>); </div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (MR(x)==<span class="number">1</span>) <span class="built_in">puts</span>(<span class="string">"Prime"</span>);</div><div class="line">        <span class="keyword">else</span>&#123;</div><div class="line">            ans=work(x);</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ans);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>data</strong><br><a href="http://pan.baidu.com/s/1o6064WU" target="_blank" rel="external">http://pan.baidu.com/s/1o6064WU</a></p>

	

	
		<span class="different-posts"><a href="/2015/09/27/number-theory2/" onclick="window.history.go(-1); return false;">â¬…ï¸ Go back </a></span>

	

</article>

	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<p>Hi there, <br />welcome to my Blog glad you found it. Have a look around, will you?</p>
</div>

	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    
	      <div class="footer__element">
	<h5>My friends</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="http://charliezhao.cn">CharlieZhao </a></li>		
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>Â© 2017 Fractal128 | Powered by <a href="https://hexo.io/">Hexo</a> | Theme <a href="https://github.com/HoverBaum/meilidu-hexo">MeiliDu</a></span>
		</div>

	</div>

	
</footer>


</body>

</html>
